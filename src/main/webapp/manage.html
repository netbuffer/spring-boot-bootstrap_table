<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>信息管理页</title>
    <!-- Add this to <head> -->
    <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/>
</head>
<body>
<div id="app" class="container-fluid">
    <b-navbar toggleable="md" type="dark" variant="info">
        <b-navbar-toggle target="nav_collapse"></b-navbar-toggle>
        <b-navbar-brand href="#">NavBar</b-navbar-brand>
        <b-collapse is-nav id="nav_collapse">
            <b-navbar-nav>
                <b-nav-item href="#">Link</b-nav-item>
                <b-nav-item href="#" disabled>Disabled</b-nav-item>
            </b-navbar-nav>
            <!-- Right aligned nav items -->
            <b-navbar-nav class="ml-auto">
                <b-nav-form>
                    <b-form-input size="sm" class="mr-sm-2" type="text" placeholder="Search"/>
                    <b-button size="sm" class="my-2 my-sm-0" type="submit">Search</b-button>
                </b-nav-form>
                <b-nav-item-dropdown text="Lang" right>
                    <b-dropdown-item href="#">EN</b-dropdown-item>
                    <b-dropdown-item href="#">ES</b-dropdown-item>
                    <b-dropdown-item href="#">RU</b-dropdown-item>
                    <b-dropdown-item href="#">FA</b-dropdown-item>
                </b-nav-item-dropdown>
                <b-nav-item-dropdown right>
                    <!-- Using button-content slot -->
                    <template slot="button-content">
                        <em>User</em>
                    </template>
                    <b-dropdown-item href="exit">退出</b-dropdown-item>
                </b-nav-item-dropdown>
            </b-navbar-nav>
        </b-collapse>
    </b-navbar>

    <template>
        <b-table responsive striped hover :items="items" :fields="fields"></b-table>
        <b-pagination align="right" size="md" :total-rows="page_total_rows" v-model="page_current"
                      :per-page="page_per_size"></b-pagination>
    </template>
</div>
<script src="//cdn.bootcss.com/vue/2.5.13/vue.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
<!-- Add this after vue.js -->
<script src="//unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
<script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
<script src="static/moment.min.js"></script>
<script src="static/moment.zh-cn.js"></script>
<script type="text/javascript">
    let API_BASE_URI = "/dev";
    let vue = new Vue({
        el: "#app",
        data() {
            return {
                "items": [],
                "page_per_size": 10,
                "page_current": 1,
                "page_total_rows": 0,
                "fields": [
                    {
                        key: 'id',
                        sortable: true
                    },
                    {
                        key: 'name',
                        label: "昵称",
                        sortable: false
                    },
                    {
                        key: 'age',
                        label: '年龄',
                        sortable: true,
                    },
                    {
                        key: 'sex',
                        label: '性別',
                        sortable: true,
                    },
                    {
                        key: "phone",
                        label: '手机',
                        sortable: true,
                    },
                    {
                        key: 'deliveryaddress',
                        label: '收获地址',
                        sortable: false,
                    },
                    {
                        key: 'adddate',
                        label: '注册日期',
                        sortable: true,
                        formatter: (value) => {
                            return moment.unix(value).format("YYYY-MM-DD hh:mm:ss a");
                        }
                    }
                ]
            };
        },
        watch: {
            // 如果 `question` 发生改变，这个函数就会运行
            page_current: function (new_page, old_page) {
                get_users(this);
            }
        },
        created() {
            get_users(this);
        }
    });

    function get_users(vue) {
        axios.get(API_BASE_URI + "/user/userlist", {
            params: {
                "limit": vue.page_per_size,
                "offset": (vue.page_current - 1) * vue.page_per_size
            }
        })
            .then(function (response) {
                vue.items = response.data.rows;
                vue.page_total_rows = response.data.total;
            })
            .catch(function (error) {
                console.log(error);
            });
    }
</script>
</body>
</html>